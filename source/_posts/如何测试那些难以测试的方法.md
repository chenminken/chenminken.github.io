---
title: 如何测试那些难以测试的方法？(stdin/stdout标准输入输出，文件，main方法，private私有方法)
date: 2019-09-23 15:23:33
tags: 
- 软件测试
- Java
---





## 如何测试标准输出中的内容

标准输出：`System.out.println()`

方法流程：
1. 使用`OutputStream, System.setOut`重定向输出流
2. 使用`System.getProperty("line.separator)`来正确的测试下一行
3. 使用`System.setOut, System.out`恢复输出流
---

### 样例代码

```java
// PrintClass.java
public class PrintClass {
	public void printSome() {
		System.out.println("Just follow your heard");
	}
}
// PrintClassTest.java,忽略掉import的部分
public class PrintClassTest {
	@Test
	public void testPrintSome() {
		// 重定向标准输出到指定printstream中
		OutputStream os = new ByteArrayOutputStream();
		PrintStream ps = new PrintStream(os);
		System.setOut(ps);
		// 执行测试代码
		PrintClass pc = new PrintClass();
		pc.printSome();
		assertEquals("Just follow your heard"
						+ System.getProperty("line.separator"),
                os.toString());
		// 恢复重定向
		PrintStream originalOut = System.out;
    	System.setOut(originalOut);
	}
}

```

完整代码在：[week2:printtest](https://github.com/chenminken/software-testing/tree/master/week2/printtest)

## 如何测试私有方法

Java中的私有方法不能通过obj.method()的方式来调用。如果需要测试私有方法怎么办？

使用反射机制获取这个私有方法。

需要使用到的方法`Class.getDeclaredMethod(), Method.setAccessible(), Method.invoke()`

方法流程：

1. 获取需要测试类的class对象（可以使用class.forname的方法，也可以直接使用[ClassName].class的方法）
2. 获取该class对象指定的私有方法的Method对象（`[classobj.class].getDeclaredMethod(String name, Class<?>... parameterTypes)`）
3. 修改私有方法的访问性为公开访问(`[MethodObj].setAccessible(true)`。
4. 实例化需要测试类的object对象(`[ClassName.class].newInstance()`)
5. 调用该私有方法测试(`[MethodObj].invoke([objectInstance], ...)`)

---

### 样例代码

```java
// PrivateMethodClass.java
public class PrivateMethodClass {
	private int privatePlus(int a, int b) {
		return a + b;
	}
}
// PrivateMethodClassTest.java
public class PrivateMethodClassTest {
    @Test
    public void testPrivatePlus1() throws NoSuchMethodException, ClassNotFoundException, IllegalAccessException, InstantiationException, InvocationTargetException {
        Class cls = Class.forName("PrivateMethodClass");
        Method msd = cls.getDeclaredMethod("privatePlus", int.class, int.class);
        msd.setAccessible(true);
        Object obj = cls.newInstance();
        int res = (Integer)msd.invoke(obj, 4,6);
        assertEquals(10, res);
    }
}
```

完整代码在：[week2:privateTest](https://github.com/chenminken/software-testing/tree/master/week2/privateTest)